## è¿­ä»£å™¨å’Œ for-of å¾ªç¯  

> padding  

æ€ä¹ˆå¾ªç¯ä¸€ä¸ªæ•°ç»„çš„å…ƒç´ å‘¢ï¼Ÿ20å¹´å‰ï¼ŒJavascript é‡Œæ˜¯è¿™ä¹ˆå†™çš„: 

    for (var index = 0; index < myArray.length; index++) {
        console.log(myArray[index]);
    }  
    
è‡ªä» ES5 èµ·ï¼Œä½ å¯ä»¥ç”¨ forEach æ–¹æ³•:  
 
     myArray.forEach(function (value) {
          console.log(value);
     });
     
è¿™æ ·çœ‹èµ·æ¥çŸ­äº›ï¼Œä½†æœ‰å‰¯ä½œç”¨: ä½ æ— æ³•ä½¿ç”¨ ``` break``` è¯­å¥æˆ–è€…é€šè¿‡```return```ä»åŒ…è£¹çš„å‡½æ•°ä¸­è¿”å›ã€‚  
  
å€˜è‹¥èƒ½ä½¿ç”¨ ```for-``` å¾ªç¯è¯­æ³•å®Œæˆå¯¹æ•°ç»„å…ƒç´ æ“ä½œå²‚ä¸æ˜¯æ›´å¥½ã€‚ 
 
é‚£ä¹ˆè¯•è¯•```for-in``` ?  
 
     for (var index in myArray) {    // don't actually do this
          console.log(myArray[index]);
     }  
     
è¿™ä¸æ˜¯ä¸€ä¸ªå¥½é€‰æ‹©:  
 
+ èµ‹å€¼ç»™ *index* çš„å®é™…ä¸Šå¾—åˆ°çš„æ˜¯```"0", "1", "2"``` ç­‰ç­‰ï¼Œ å¹¶ä¸æ˜¯æ•°å­—ã€‚ä½ ä¸€å®šä¸æƒ³å¾—åˆ°è¿™æ ·çš„å­—ç¬¦ä¸²è¿ç®—("2" + 1 == "21"), è¿™ä¸€ç‚¹ä¹Ÿä¸æ–¹ä¾¿ã€‚  

+ å¾ªç¯ä½“ä¸ä»…å¯¹æ•°ç»„å¯¹è±¡æœ¬èº«å¾ªç¯ï¼Œ è€Œä¸”ä¼šå°†èµ‹å€¼æ“ä½œåçš„å±æ€§ä¹Ÿè¿›è¡Œå¾ªç¯ï¼Œä¾‹å¦‚ï¼Œæ•°ç»„ myArrayæœ‰ä¸ªæšä¸¾å±æ€§ myArray.name, é‚£ä¹ˆå¾ªç¯å°†å¤šå¾ªç¯ä¸€æ¬¡ï¼Œè€Œé‚£æ¬¡çš„ç´¢å¼• index == "name"ã€‚ç”šè‡³æ˜¯æ•°ç»„ prototype ç»§æ‰¿é“¾ä¸Šçš„å±æ€§éƒ½ä¼šè¢«è®¿é—®åˆ°ã€‚  

+ æ›´ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ•°ç»„å†…çš„å¾ªç¯å¯èƒ½ä¸ä¼šé¡ºåºæ‰§è¡Œã€‚  

ç®€å•æ¥è¯´ï¼Œfor-in ä¸»è¦ä½œç”¨äº plain old objects çš„å­—ç¬¦ä¸² keysã€‚å¯¹äºæ•°ç»„ï¼Œæ•ˆæœå¹¶ä¸å¥æ•ˆã€‚  

###å¼ºå¤§çš„ for-of å¾ªç¯  

è¿˜è®°å¾—ä¸Šå‘¨æˆ‘æ‰¿è¯º ES6 å¹¶ä¸ä¼šç ´ååŸå…ˆä½ å†™çš„ Js ä»£ç å§ã€‚æ•°ä»¥ç™¾ä¸‡çš„ç½‘ç«™æœ‰ç”¨åˆ° for-in å¾ªç¯ï¼Œ ç”šè‡³æ˜¯ç”¨åœ¨æ•°ç»„çš„å¾ªç¯ä¸Šã€‚æ‰€ä»¥å»ä¿® for-in å¾ªç¯ï¼Œè®©å…¶é€‚ç”¨äº arrays æ˜¯ä¸ç°å®çš„ã€‚å¯¹äº ES6ï¼Œæ”¹è¿›çš„å”¯ä¸€åŠæ³•å°±æ˜¯å¼•å…¥ä¸€ç§æ–°çš„å¾ªç¯è¯­æ³•ã€‚  

tada:  

    for (var value of myArray) {
         console.log(value);
    }  
    
é¢ï¼Œçœ‹èµ·æ¥ä¼¼ä¹å¹¶æ²¡æœ‰å¾ˆé…·ç‚«ï¼Œå¯¹å§ï¼Ÿ åé¢æˆ‘ä»¬ä¼šçœ‹çœ‹è¿™è‘«èŠ¦é‡Œå–çš„ä»€ä¹ˆè¯ï¼Œç›®å‰åªéœ€çŸ¥é“:  

+ for-of æ˜¯è¿„ä»Šä¸ºæ­¢å¯¹æ•°ç»„å¾ªç¯æœ€ç®€æ˜ç›´æ¥çš„çš„æ–¹å¼ã€‚  
+ å®ƒé¿å¼€äº† for-in æ‰€æœ‰çš„å‘ã€‚  
+ ä¸ forEach ä¸åŒçš„æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ break, continue å’Œ returnã€‚  

for-in å¾ªç¯ç”¨æ¥æ“ä½œå¯¹è±¡çš„å±æ€§ã€‚  
for-of ç”¨æ¥å¾ªç¯ç±»ä¼¼æ•°ç»„ï¼Œä½†ä¸æ­¢äºæ­¤ã€‚  

###å…¶ä»–æ”¯æŒ for-of çš„é›†åˆ  

for-of ä¸ä»…ä»…æ”¯æŒ Arrayï¼ŒåŒæ ·é€‚ç”¨äºç±» Array çš„æ•°æ®ï¼Œæ¯”å¦‚ DOM NodeListsã€‚  
å®ƒåŒæ ·æ”¯æŒå­—ç¬¦ä¸²çš„å¾ªç¯ï¼Œä¾‹å¦‚ï¼š  

    for (var chr of "ğŸ˜ºğŸ˜²") {
      alert(chr);
    }  
    
åŒæ—¶æ”¯æŒ Map è·Ÿ Set å¯¹è±¡ã€‚ 

æŠ±æ­‰ï¼Œä½ æ²¡å¬è¿‡ Map å’Œ Setï¼Ÿè¿™å¯æ˜¯ ES6 é‡Œå¼•å…¥çš„æ–°ç±»å‹ï¼Œæˆ‘ä»¬ä¼šåœ¨åç»­ç”¨ä¸€æ•´ç« æ¥è®²ã€‚å‡å¦‚ä½ åœ¨åˆ«çš„è¯­è¨€é‡Œå·²ç”¨è¿‡äº†è¿™äº›ä¸œè¥¿çš„è¯ï¼Œä½ ä¸ä¼šæ„Ÿåˆ°æƒŠè®¶ã€‚  

ä¸¾ä¸ªä¾‹å­ï¼Œ Set é€‚åˆç”¨æ¥å»é‡ã€‚  

    // make a set from an array of words
    var uniqueWords = new Set(words);  
    
ä¸€æ—¦åˆ›å»ºä¸€ä¸ª Setï¼Œ ä½ å¯ä»¥å¾ˆå®¹æ˜“å¯¹å®ƒè¿›è¡Œå¾ªç¯ã€‚  

    for (var word of uniqueWords) {
      console.log(word);
    }  
    
Map æœ‰äº›è®¸ä¸åŒï¼šå†…éƒ¨ç”±é”®å€¼å¯¹æ„æˆï¼Œå¯æŒ‰ç…§ä¸‹é¢æ–¹å¼éå†ï¼š  

    for (var [key, value] of phoneBookMap) {
      console.log(key + "'s phone number is: " + value);
    }  
    
ä»¥ä¸Šæ–¹å¼æ˜¯Destructuringï¼Œ æ˜¯ ES6 çš„æ–°ç‰¹æ€§ï¼Œåœ¨åé¢ä¼šé‡ç‚¹ä»‹ç»ã€‚  

ç›®å‰ä¸ºæ­¢ï¼Œä½ å¯ä»¥çœ‹åˆ°è¿™ä¹ˆä¸€å¹…æ™¯è±¡ï¼šJs å¢æ·»è¶Šæ¥è¶Šå¤šçš„ä¸åŒç±»å‹ï¼Œè€Œä½ å°†é¢‘ç¹çš„ç”¨ for-of å¾ªç¯æ“ä½œå®ƒä»¬ã€‚  

é—æ†¾çš„æ˜¯ for-of å¾ªç¯ä¸æ”¯æŒ plain old objectsï¼Œ å¯ä»¥é€šè¿‡ for-in æˆ–è€…é€šè¿‡ object.keys() å¾ªç¯ã€‚  

    // dump an object's own enumerable properties to the console
    for (var key of Object.keys(someObject)) {
      console.log(key + ": " + someObject[key]);
    }
    
###å¸½æªä¹‹ä¸‹    

*â€œGood artists copy, great artists steal.â€ â€”Pablo Picasso*  

ES6 çš„ç‰¹æ€§å¤šæ•°ä¸æ˜¯ç©ºç©´æ¥é£ï¼Œå®ƒä»¬æ—©å·²åœ¨å…¶ä»–è¯­è¨€é‡Œå¾—åˆ°éªŒè¯ã€‚  

for-of å¾ªç¯ï¼Œ ç±»ä¼¼äº C++, Java, C#, Python é‡Œçš„å¾ªç¯ï¼Œé€‚ç”¨äºè¯­è¨€åŠåº“æä¾›çš„å¤šç§ä¸åŒæ•°æ®ç»“æ„ï¼ŒåŒæ—¶ä¹Ÿæ˜¯è¯­è¨€çš„æ‰©å±•ç‚¹ä¹‹ä¸€ã€‚  

ä¸ forEach ç›¸åŒï¼Œfor-of å®Œå…¨é€‚ç”¨äºæ–¹æ³•è°ƒç”¨çš„æ–¹å¼ã€‚Arraysï¼ŒMapsï¼ŒSets ä»¥åŠæˆ‘ä»¬æåˆ°çš„å…¶ä»–ç±»å‹ï¼Œå®ƒä»¬çš„å…±åŒç‚¹æ˜¯éƒ½æ‹¥æœ‰è¿­ä»£å™¨æ–¹æ³•ã€‚  

è¿˜æœ‰å¦ä¸€ç§å¯¹è±¡å¯ä»¥æ”¯æŒè¿­ä»£å™¨ï¼Œç­”æ¡ˆæ˜¯ä»»ä½•ä½ æƒ³è¦çš„å¯¹è±¡ã€‚

ä½ åªéœ€ myObject.toString()ï¼Œ Js å°±çŸ¥é“å¦‚ä½•å°†å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚å¾ªç¯äº¦å¦‚æ­¤ï¼Œ```myObject[Symbol.iterator]()``` è¿™æ · Js ä¾¿çŸ¥é“å¦‚ä½•å¯¹å¯¹è±¡å¾ªç¯ã€‚  

ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä½¿ç”¨ JQueryï¼Œä½ éå¸¸å–œæ¬¢ç”¨ .each(), æƒ³è¦ for-of æ”¯æŒ JQuery å¯¹è±¡ï¼Œåº”è¯¥è¿™æ ·å†™ï¼š  

    // Since jQuery objects are array-like,
    // give them the same iterator method Arrays have
    jQuery.prototype[Symbol.iterator] =
    Array.prototype[Symbol.iterator];  
    
å¥½å§ï¼Œæˆ‘çŸ¥é“ä½ åœ¨æƒ³ä»€ä¹ˆï¼Œ[Symbol.iterator] è¯­æ³•å¤ªå¥‡æ€ªäº†ã€‚å§”å‘˜ä¼šæœ¬æ¥å†³å®šåªç”¨ .iterator()ï¼Œç„¶è€Œç°æœ‰çš„ä»£ç å¯èƒ½æœ‰äº›å¯¹è±¡æœ¬èº«æœ‰ç”¨åˆ° .iterator()ï¼Œæ‰€ä»¥æœ€ç»ˆå§”å‘˜ä¼šå†³å®šç”¨ symbol,  è€Œä¸æ˜¯æŒ‚åœ¨ string ä¸‹ã€‚  

Symbols æ˜¯ ES6 çš„æ–°ç‰¹æ–°ä¹‹ä¸€ï¼Œåç»­æ–‡ç« ä¼šç»†è®²ã€‚ä½ ç°åœ¨åªéœ€çŸ¥é“çš„æ˜¯ï¼Œç”¨ Symbol.iteratorï¼Œå¯ä»¥ä¿è¯ä»¥å‰çš„ä»£ç ä¸ä¼šæœ‰ä»»ä½•å†²çªã€‚ç”¨æ›´å¥½çš„ç‰¹æ€§å’Œå…¼å®¹æ€§æ¥è¯´ï¼Œè€Œä»£ä»·ä»…ä»…æ˜¯è¯­æ³•çœ‹èµ·æ¥æœ‰ç‚¹æ€ªè€Œå·²ã€‚  

æˆ‘ä»¬æŠŠåŒ…å« [Symbol.iterator] æ–¹æ³•çš„å¯¹è±¡ç§°ä½œ å¯è¿­ä»£çš„ã€‚æ¥ä¸‹æ¥ä¼šçœ‹åˆ°çš„æ˜¯ï¼Œå¯è¿­ä»£çš„å¯¹è±¡éå¸ƒæ•´ä¸ªè¯­è¨€ï¼Œä¸ä»…æ˜¯ for-ofï¼Œè€Œä¸”åœ¨ Mapï¼Œ Setï¼Œdestructuring èµ‹å€¼ï¼Œè¿˜æœ‰æ–°çš„ spread è¿ç®—ç¬¦ã€‚  

###è¿­ä»£å¯¹è±¡  

ç°åœ¨ä½ å‹æ ¹ä¸éœ€è¦åˆ€è€•ç«ç§å®ç°è¿­ä»£å™¨ï¼Œä¸‹å‘¨å‘Šè¯‰ä½ åŸå› ã€‚ä½†ä¸ºäº†é˜…è¯»å®Œæ•´æ€§ï¼Œè®©æˆ‘ä»¬ç§ç§ç©¶ç«Ÿ(é”™è¿‡è¿™éƒ¨åˆ†ï¼Œæˆ‘ä¿è¯ä½ ä¼šåæ‚”çš„)ã€‚  

for-of å¾ªç¯åœ¨é›†åˆä¸Šè°ƒç”¨ ```[Symbol.iterator]()```ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªè¿­ä»£å™¨çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥æ˜¯åŒ…å« .next() æ–¹æ³•çš„ä»»æ„å¯¹è±¡ï¼› for-of åˆ™ä¼šå¾ªç¯è°ƒç”¨è¯¥æ–¹æ³•ã€‚ä¸‹é¢æ˜¯æœ€ç®€å•çš„è¿­ä»£å™¨å¯¹è±¡:  

    var zeroesForeverIterator = {
        [Symbol.iterator]: function () {
            return this;
        },
        next: function () {
            return {done: false, value: 0};
        }
    };  
    
æ¯æ¬¡è°ƒç”¨  .next() å¾—åˆ°åŒæ ·çš„è¿”å›å€¼ï¼Œå‘Šè¯‰å¾ªç¯ä½“ a) å¾ªç¯è¿˜æ²¡ç»“æŸã€‚ b) next çš„ value ä¸º 0ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œå½“ç„¶å…¸å‹çš„å¾ªç¯ä¸é•¿è¿™æ ·ã€‚  

æ‹¥æœ‰ .done è·Ÿ .value çš„ Js è¿­ä»£å™¨ï¼Œ è¡¨é¢çœ‹ä¸Šå»ä¸å…¶ä»–è¯­è¨€çš„ä¸åŒã€‚Java é‡Œæ˜¯ .hasNext() è·Ÿ .next()ã€‚Python é‡Œåªæœ‰ .next()ï¼Œå½“å€¼ä¸å­˜åœ¨æ—¶ï¼Œä¼šæŠ›å‡º StopIteration å¼‚å¸¸ã€‚ä½†ä¸‰ç§æ–¹å¼åŸºæœ¬éƒ½è¿”å›åŒæ ·çš„ä¿¡æ¯ã€‚  

è¿­ä»£å™¨å¯¹è±¡èƒ½å®ç°å¯é€‰çš„  .return()ï¼Œ.throw(exc) æ–¹æ³•ã€‚å½“å¾ªç¯å› ä¸ºå¼‚å¸¸æˆ–é‡åˆ°*break* åŠ*return*å£°æ˜è€Œææ—©é€€å‡ºæ—¶ .return() ä¼šè¢«è°ƒç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ .return() é‡Œåšä¸€äº›æ¸…ç†æˆ–è€…é‡Šæ”¾èµ„æºçš„å·¥ä½œã€‚å¤§å¤šæ•°è¿­ä»£å¯¹è±¡å¹¶ä¸éœ€è¦è‡ªå·±å®ç°è¯¥æ–¹æ³•ã€‚.throw(exc) æ›´æ˜¯ä¸ªç‰¹æ®Šæƒ…å†µ: for-of å¾ªç¯æ°¸è¿œä¸ä¼šè°ƒç”¨å®ƒï¼Œè¿™ä¸ªä¼šåœ¨ä¸‹å‘¨ç»†è®²ã€‚  

æ—¢ç„¶çŸ¥é“äº†ç»†èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç®€å• for-of å¾ªç¯å…¥æ‰‹ï¼Œç”¨è¿™äº›åŸºç¡€æ–¹æ³•æ¥é‡å†™å®ƒã€‚  

é¦–å…ˆ for-of å¾ªç¯ï¼š  

    for (VAR of ITERABLE) {
      STATEMENTS
    }
    
è¿™ä¸ªç²—ç³™çš„ç‰ˆæœ¬ï¼Œç”¨äº†äº›åŸºç¡€æ–¹æ³•åŠä¸´æ—¶å˜é‡:  

    var $iterator = ITERABLE[Symbol.iterator]();
    var $result = $iterator.next();
    while (!$result.done) {
      VAR = $result.value;
      STATEMENTS
      $result = $iterator.next();
    }

ä¸Šé¢ä»£ç é‡Œå¹¶æ²¡æœ‰å†™ .return() æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ã€‚ æˆ‘ä»¬å¯ä»¥æ·»åŠ è¿™éƒ¨åˆ†ï¼Œä½†æˆ‘è¿˜æ˜¯å€¾å‘äºæš‚æ—¶ç•¥è¿‡å§ã€‚æ€»ä¹‹ï¼Œ for-of æå®¹æ˜“ä½¿ç”¨ï¼Œç„¶è€ŒèƒŒåå´åˆ«æœ‰æ´å¤©ã€‚  

###å¥½äº†ï¼Œå¿«å‘Šè¯‰æˆ‘ä»€ä¹ˆæ—¶å€™èƒ½ç”¨ä¸Šï¼Ÿ  

ç«ç‹ç›®å‰å·²å®Œå…¨æ”¯æŒï¼Œchrome ä¸‹éœ€è¦æ‰“å¼€chrome://flagsï¼Œ ç‚¹å‡» â€œExperimental JavaScriptâ€ï¼Œ å¾®è½¯å®¶çš„ Spartan æµè§ˆå™¨ä¹Ÿæ”¯æŒï¼ŒIE ä¸å‡ºæ‰€æ–™å¹¶ä¸æ”¯æŒï¼Œå¦‚æœè¦ä½¿å…¶æ”¯æŒ IE åŠ safari,  ä½ å¯ä»¥ä½¿ç”¨ Babel æˆ–è€…  Googleâ€™s Traceur ç­‰ç¿»è¯‘å·¥å…·å°† ES6 ä»£ç ç¿»è¯‘æˆ ES5ä»£ç ã€‚  

åœ¨æœåŠ¡ç«¯ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ - ä½ å¯ä»¥åœ¨ io.js é‡Œç›´æ¥ç”¨ for-of å¾ªç¯(æˆ–è€… nodejs,  --harmony æ–¹å¼)ã€‚  

{done: true}

å¥½å•¦ï¼ä»Šå¤©å°±åˆ°æ­¤ä¸ºæ­¢ï¼Œå…³äº for-of çš„ä»‹ç»è¿˜æ²¡æœ‰ç»“æŸã€‚  

ES6 é‡Œè¿˜æœ‰ä¸€ç§æ–°å¯¹è±¡ç±»å‹ï¼Œéå¸¸å¥½çš„é€‚åº” for-ofï¼Œåªå­—æœªæçš„åŸå› æ˜¯å®ƒæ˜¯ä¸‹å‘¨çš„ä¸»é¢˜ã€‚å¦‚æœä½ åœ¨åˆ«çš„è¯­è¨€é‡Œè¿˜æœªé‡åˆ°è¿‡ï¼Œä½ å¯èƒ½ä¼šå½»åº•éœ‡æƒŠã€‚ç„¶è€Œè¿™æ˜¯æœ€å®¹æ˜“å†™è¿­ä»£å™¨çš„æ–¹æ³•ï¼Œéå¸¸é€‚åˆé‡æ„ä»£ç ï¼Œè€Œä¸”å°†å®Œå…¨æ”¹å˜å†™å¼‚æ­¥è°ƒç”¨ä»£ç çš„æ–¹å¼ï¼Œæ— è®ºæ˜¯æœåŠ¡ç«¯è¿˜æ˜¯æµè§ˆå™¨ç«¯ã€‚æ‰€ä»¥è¯·åŠ¡å¿…æŒç»­å…³æ³¨ã€‚